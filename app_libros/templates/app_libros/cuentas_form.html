{% extends 'app_libros/base.html' %}

{% block title %}
{% if modo == 'crear' %}Crear usuario{% else %}Editar usuario{% endif %}
{% endblock %}

{% block content %}
<h2>
  {% if modo == 'crear' %}Crear usuario{% else %}Editar usuario{% endif %}
  {% if obj %}<small class="text-muted">: {{ obj.username }}</small>{% endif %}
</h2>

<form method="post" class="mt-3">
  {% csrf_token %}

  <div class="row g-3">
    <div class="col-md-6">
      {# En "crear" existe username; en "editar" no necesariamente #}
      {% if form.username %}
        <div class="mb-3">
          <label class="form-label">{{ form.username.label }}</label>
          {{ form.username }}
          {% if form.username.errors %}<div class="text-danger small">{{ form.username.errors }}</div>{% endif %}
        </div>
      {% endif %}

      <div class="mb-3">
        <label class="form-label">{{ form.first_name.label }}</label>
        {{ form.first_name }}
        {% if form.first_name.errors %}<div class="text-danger small">{{ form.first_name.errors }}</div>{% endif %}
      </div>

      <div class="mb-3">
        <label class="form-label">{{ form.last_name.label }}</label>
        {{ form.last_name }}
        {% if form.last_name.errors %}<div class="text-danger small">{{ form.last_name.errors }}</div>{% endif %}
      </div>

      <div class="mb-3">
        <label class="form-label">{{ form.email.label }}</label>
        {{ form.email }}
        {% if form.email.errors %}<div class="text-danger small">{{ form.email.errors }}</div>{% endif %}
      </div>

      {% if form.is_active %}
        <div class="form-check mb-3">
          {{ form.is_active }} <label class="form-check-label">{{ form.is_active.label }}</label>
        </div>
      {% endif %}
    </div>

    <div class="col-md-6">
      <div class="mb-3">
        <label class="form-label d-block">Grupos / Roles</label>
        {{ form.grupos }}
        {% if form.grupos.errors %}<div class="text-danger small">{{ form.grupos.errors }}</div>{% endif %}
      </div>

      {% if modo == 'crear' %}
        <div class="mb-3">
          <label class="form-label">{{ form.password1.label }}</label>
          {{ form.password1 }}
          {% if form.password1.errors %}<div class="text-danger small">{{ form.password1.errors }}</div>{% endif %}
        </div>
        <div class="mb-3">
          <label class="form-label">{{ form.password2.label }}</label>
          {{ form.password2 }}
          {% if form.password2.errors %}<div class="text-danger small">{{ form.password2.errors }}</div>{% endif %}
        </div>
      {% else %}
        <div class="alert alert-info py-2">Deja en blanco para no cambiar la contrase√±a.</div>
        <div class="mb-3">
          <label class="form-label">{{ form.password1.label }}</label>
          {{ form.password1 }}
          {% if form.password1.errors %}<div class="text-danger small">{{ form.password1.errors }}</div>{% endif %}
        </div>
        <div class="mb-3">
          <label class="form-label">{{ form.password2.label }}</label>
          {{ form.password2 }}
          {% if form.password2.errors %}<div class="text-danger small">{{ form.password2.errors }}</div>{% endif %}
        </div>
      {% endif %}
    </div>
  </div>

  <div class="mt-3">
    <a href="{% url 'cuentas_list' %}" class="btn btn-secondary">Volver</a>
    <button class="btn btn-primary" type="submit">Guardar</button>
  </div>
</form>
{% endblock %}
